---
title: "Case study 3"
author: "Tran Thanh Hoa"
date: "12-13-2025"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    highlight: tango
  pdf_document:
    toc: true
encoding: "UTF-8"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,       # Show code (select FALSE if reporting to the sales manager)
  warning = FALSE,   # Hide technical warnings
  message = FALSE,   # Hide package download notification
  comment = "",      # Remove the ## before the result
  fig.width = 8,     # Default chart width
  fig.height = 5     # Default chart height
)
```


<style>
body {
  font-family: "Noto Sans", "Roboto", "Arial", "Helvetica", sans-serif;
  font-size: 14px;
  line-height: 1.5;
}
</style>


```{css, echo=FALSE}
/* Setting Title  */
h1.title {
  font-size: 38px;      /* Font size */
  color: #2E8B57;       /* color  */
  font-family: "Arial"; /* Font type */
  text-align: center;   /* alignment */
}

/* Setting Subtitle */
h3.subtitle {
  font-size: 24px;
  color: darkred;
}
/* Heading Level 1 (#) */
h1 {
  color: #003366;     /* Dark Blue */
  font-size: 28px;

}

/* Heading Level 2 (##) */
h2 {
  color: #2E8B57;     /* Sea Green */
  font-size: 22px;
  font-style: italic;
}

/* Heading Level 3 (###) */
h3 {
  color: #FF4500;     /* Orange Red */
  font-size: 18px;
}
```

# **1. Introduction** 

Bộ dữ liệu được lấy từ nguồn [Customer Personality Analysis](https://www.kaggle.com/datasets/imakash3011/customer-personality-analysis) cung cấp bởi **Dr.Omar Romero - Hernandez** và được mô phỏng tình huống kinh doanh từ một công ty buôn bán các mặt hàng sản phẩm (Rượu, thịt, cá,...).

Dự án này xác định các phân khúc khách hàng và khám phá những hành vi của khách hàng để hỗ trợ tối ưu hoá chiến lược tiếp thị và bán hàng dựa theo dữ liệu.

## 1.1 Business Context 

Công ty hiện đang sở hữu một tập dữ liệu lớn về hành vi mua hàng, nhân khẩu học và phản hồi marketing của khách hàng trong vòng **2 năm (2013 - 2014)**.

Tuy nhiên, các chiến dịch marketing trước đây được triển khai đồng loạt cho toàn bộ tập khách hàng, dẫn đến:

- Chi phí marketing cao.

- Tỷ lệ phản hồi (acceptance rate) thấp.

- Khó tối ưu sản phẩm và kênh bán hàng cho từng nhóm khách hàng.

Ban lãnh đạo mong muốn sử dụng dữ liệu để **hiểu rõ chân dung khách hàng lý tưởng (ideal customers)** và **xác định các phân khúc khách hàng có giá trị cao**.

## 1.2 Business Task 

*Xác định và phân tích các phân khúc khách hàng dựa trên nhân khẩu học, hành vi mua sắm và phản hồi marketing, nhằm tối ưu hoá chiến lược marketing và phân bố nguồn lực bán hàng.*

Diễn giải rõ hơn :

- Khách hàng nào mang lại giá trị cao nhất cho công ty ?

- Đặc điểm hành vi và nhân khẩu học của họ là gì?

- Nhóm khách hàng nào có khả năng phản hồi tốt và các chiến dịch khuyến mãi?

- Có nên tiếp tục marketing đại trà hay chuyển sang targeted marketing theo segment?

## 1.3 Business Questions

**Các câu hỏi cần trả lời:**

1.Có thể chia khách hàng thành những nhóm (segments) nào dựa trên:

- Nhân khẩu học (Mức lương, tuổi, Học vị, ...).

- Hành vi chi tiêu theo nhóm sản phẩm.

- Kênh mua hàng (Web/store/Catalog).

2.Nhóm khách hàng nào:

- Chi tiêu nhiều nhất?

- Mua hàng thường xuyên nhất?

- Ít nhạy cảm với khuyến mãi?

3.Các yếu tố nào ảnh hưởng mạnh nhất đến việc:

- Khách hàng nào chấp nhận chiến dịch Marketing(Response, AcceptedCMP1-5)?

4.Kênh mua hàng nào hiệu quả nhất đối với từng nhóm khách hàng?

## 1.4 Metrics

Các chỉ số được tạo hoặc có sẵn trong dữ liệu nhằm mục đích phục vụ cho việc phân tích, kết hợp các biến, yếu tố để đưa ra quyết định.

**Nhóm giá trị khách hàng**

- Total Spending = tổng chi tiêu trên tất cả danh mục sản phẩm.

- Recency: Số ngày kể từ lần mua gần nhất.

- Purchase Frequency: NumWebPurchases, NumStorePurchases, NumCagtalogPurchases.

**Nhóm Marketing**

- Campaign Acceptance Rate

- Response Rate (last campaign)

- Deal Dependency: NumDealsPurchases/Total Purchases

**Nhóm kênh bán hàng**

- Tỷ trọng mua hàng theo từng kênh.

- Số lần truy cập website vs số lần mua (Conversion proxy).

## 1.5 STAKEHOLDERS

**Marketing Manager**

- Muốn biết nên **target chiến dịch vào nhóm khách hàng nào**.

- Quan tâm đến tỷ lệ chấp nhận khuyến mãi và hành vi phản hồi.

**Sale Manager**

- Quan tâm đến **kênh bán hàng hiệu quả**.

- Muốn phân bổ nguồn lực giữa Store / Web / Catalog.

**Product Manager**

- Muốn hiểu **nhóm khách hàng nào phù hợp với từng loại sản phẩm**.

- Dùng insight để phát triển sản phẩm mới.

## 1.6 Business Requirement

**Yêu cầu bắt buộc**

- Phân khúc khách hàng rõ ràng, có thể diễn giải.

- Insight phải: Gắn với hành động (Actionable), Trả lời được câu hỏi marketing.

**Yêu cầu không bắt buộc(nice - to - have)**

- So sánh hành vi giữa khách hàng có con/ không con.

- Phân tích loyalty dựa trên Recency + Frequency.

- Đề xuất chiến lược cá nhân hoá marketing.

## 1.7 Deliverables 

Báo cáo phân tích (R Markdown -> HTML).

Biểu đồ: 

- Customer segments.

- Spending patterns. 

- Campaign response. 

Danh sách recommendations: 

- Nhóm nên ưu tiên marketing.

- Nhóm nên giảm chi phí tiếp cận.

- Gợi ý kênh marketing phù hợp.

# **2. Prepare**

## 2.1 Data Sources

Dữ liệu được sử dụng trong dự án này là bộ [Customer Personal Analysis](https://www.kaggle.com/datasets/imakash3011/customer-personality-analysis), bao gồm thông tin về:

- Nhân khẩu học khách hàng.

- Hành vi mua sắm theo nhóm sản phẩm.

- Phản hồi đối với các chiến dịch Marketing.

- Kênh mua hàng và mức độ tương tác trực tuyến.

Dataset phản ánh hành vi của khách hàng trong **Khoảng thời gian 2 năm**, đủ dài để quan sát xu hướng chi tiêu và phản ứng marketing.

## 2.2 Data Structure

Dữ liệu được tổ chức ở cấp độ **mỗi dòng tương ứng với một khách hàng duy nhất**, bao gồm

- Thông tin cá nhân (tuổi, thu nhập, tình trạng hôn nhân,...).

- Tổng chi tiêu theo từng danh mục sản phẩm.

- Số lần mua hàng theo từng kênh.

- Các biến phản ánh hành vi marketing và mức độ trung thành.

Cấu trúc này phù hợp cho:

- Phân tích giá trị khách hàng.

- Phân khúc khách hàng (customer segmentation).

- Phân tích hành vi phản hồi chiến dịch.

## 2.3 Đánh giá độ tin cậy dữ liệu (ROCCC)

- **Reliable (Đáng tin cậy)**: .

- **Original (Nguyên bản)**: .

- **Comprehensive (Toàn diện)**: Bao phủ nhiều khía cạnh quan trọng (Nhân khẩu học, chi tiêu, kênh mua, marketing).

- **Current (Cập nhật)**: .

- **Cited (Được trích dẫn)**: .

## 2.4 Hạn chế và rủi ro dữ liệu

Những hạn chế này được ghi nhận để tránh diễn giải quá đà khi đưa ra khuyến nghị

- Không có dữ liệu về lợi nhuận hoặc chi phí marketing. 

- Không phản ánh hành vi khách hàng sau thời điểm thu thập.

- Một số biến nhân khẩu học có thể thiếu hoặc không cập nhật.

# **3. Process**

## 3.1 Data Cleaning Strategy

Mục tiêu của bước xử lý dữ liệu là đảm bảo:

- Mỗi khách hàng được biểu diễn chính xác một lần.

- Các biến có thể so sánh và phân tích được.

- Không có sai lệch lớn do dữ liệu lỗi hoặc thiếu, outlier.

## 3.2 Data Cleaning Steps

Các package được sử dụng cho phân tích này:

- `tidyverse`
- `lubridate`
- `ggplot2`
- `skimr`
- `Janitor`
- `knitr`
- `dplyr`
- `gridExtra`
```{r, echo = FALSE}

library(tidyverse)
library(ggplot2)
library(lubridate)
library(skimr)
library(janitor)
library(knitr)
library(ggpubr)
library(dplyr)
library(scales)
library(gridExtra)
```

Tiến hành đọc dataset cho phân tích:

```{r}
dataframe <- read.table('C:/Users/Admin/Downloads/marketing_campaign.csv',sep = "\t", header = T)
```

Preview dataset:
```{r}

glimpse(dataframe)

```
### 3.2.1 Missing value & Duplicate

Tiến hành kiểm tra dữ liệu có bị trùng hay không, đảm bảo mọi quan sát được biểu diễn chính xác một lần. 
```{r}

sum(duplicated(dataframe$ID))

```

## 3.2 Feature Engineering

Tạo các biến tổng hợp (Các tính năng) để phục vụ cho Analyze:

- Biến `Age` đã được tạo trước đó từ việc trích xuất từ dữ liệu năm sinh của khách hàng.

- `Marital_Status` mục đích khảo sát về tình trạng hôn nhân của khách hàng tại thời điểm thu thập, tuy nhiên khi thu thập dữ liệu, xuất hiện các quan sát có thể được xem là giá trị không xác định rõ ràng, dữ liệu nhiễu (noise) và cần cân nhắc việc gộp hoặc loại bỏ.

- `Family_Status` biểu thị tình trạng con cái trong gia đình. Vì biến số này sẽ ảnh hưởng mạnh đến việc họ chi tiêu mua hàng.

- Biến `Total_Spending` được tính bằng tổng chi tiêu tất cả danh mục sản phẩm của dữ liệu khách hàng. Mục tiêu của việc lập biến này để làm thước đo giá trị khách hàng, trục chính cho segmentation và Insight.

- BIến `Total_Purchases` được tính bằng tổng số lần mua dựa trên dữ liệu khách hàng đã mua. Đo mức độ gắn kết (engagement, phân biệt mua nhiều với mua ít nhưng giá trị cao). 

- Biến `Avergare_Order_Value`(khách mua ít nhưng đơn lớn, khách mua nhiều nhưng giá trị thấp). Biến này được tính bằng cách dùng phép chia giữa 2 biến `Total_Spending` và `Total_Purchases`.

- Biến `Deal_Dependency` giúp ta phân biệt được (Value-driven customers, Deal-driven customers).

```{r}
# Tuổi.
dataframe_cleaning <- dataframe %>%
  mutate(Age = 2026 - Year_Birth)

# Tình trạng hôn nhân của các khách hàng.
dataframe_cleaning <- dataframe_cleaning %>%
  mutate(Marital_Status = case_when(
          Marital_Status %in% c("Absurd","Alone","Divorced", "YOLO", "Widow", "Single") ~ "Single",
          Marital_Status %in% c("Together","Married") ~ "Married"))

# Tình trạng con cái của các khách hàng

dataframe_cleaning <- dataframe_cleaning %>%
  mutate(Family_Status = case_when(Kidhome + Teenhome > 0 ~ "Parent",
                                   TRUE ~ "Childless"))

# Tổng chi tiêu cho từng sản phẩm
dataframe_cleaning <- dataframe_cleaning %>% 
  mutate(Total_Spending = 
           MntWines + MntFruits + MntMeatProducts + MntFishProducts +  MntSweetProducts + MntGoldProds )

# Tổng số lần mua hàng trên toàn kênh mua sắm.
dataframe_cleaning <- dataframe_cleaning %>%
  mutate(Total_Purchase = NumWebPurchases + NumCatalogPurchases + NumStorePurchases)

## Những đặc trưng của hành vi

# Giá trị trung bình chi tiêu

dataframe_cleaning <- dataframe_cleaning %>%
  mutate(Average_Order_Value = ifelse(Total_Purchase != 0,
                                      Total_Spending / Total_Purchase, 0))
# Chỉ số sử dụng khuyến mãi trong các đơn hàng
dataframe_cleaning <- dataframe_cleaning %>%
  mutate(Deal_Dependency = ifelse(Total_Purchase != 0, 
                                  NumDealsPurchases / Total_Purchase,0))

```


## 3.3 Phân phối giá trị của các biến và xử lý các giá trị bất thường.

**Vấn đề**:

- `Year_Birth` (dữ liệu này được thu thập vào năm 2014-2015, tuy nhiên nếu xét về thời điểm 2014 - 2015 thì với giá trị 1893 thì tuổi sẽ là >100 tuổi thì điều này có thể xảy ra nhưng rất khó để phân khúc khách hàng nên vì vậy chúng ta sẽ loại bỏ các quan sát và ta xem đó là dữ liệu lỗi/outlier).

- `Income` (xuất hiện mức lương khá cao và khá tròn đó là 666666 nếu so với phân vị thứ 3 đến cuối, thì giá trị này có thể được xem là giá trị bất thường/outlier. Chúng ta sẽ tiến hành trực quan bằng cách vẽ biểu đồ ở bước EDA).

- `Education` là học vị của khách hàng, trong phần dữ liệu xuất hiện giá trị trùng lập "2nd cycle" và "Master", sẽ tiến hành gộp thành giá trị "Master".

- `Total_Spending` của khách hàng có điểm bất thường ở phân vị thứ 75 đến Max, khoảng cách khá xa nhau (Có thể có outlier).

- `Average_Order_Value` xuất hiện Outlier (cần xem xét).

**Mục đích**: Để hiểu rõ về phân phối của các biến, để xem dữ liệu phân bố cũng như xem xét các outlier của dữ liệu.

**Tránh tình trạng**:

- Giá trị thiếu ở các biến phân tích chính.

- Phân phối dữ liệu không hợp lý.

- Phát sinh lỗi logic.

Tiến hành Phân tích đơn biến (Tuổi, Mức thu nhập, Tổng chi tiêu của khách hàng, trung bình giá trị của đơn hàng, Học vị).

### Biến `Year_Birth`

- Loại bỏ các tuổi > 90. 

```{r}
dataframe_cleaning <- dataframe_cleaning %>%
  filter(Age < 90)
summary(dataframe_cleaning$Age)
```

### Biến `Income`

```{r}
summary(dataframe_cleaning$Income)
```

Tiến hành xem chi tiêu mua sắm của những người có Income là NA, để xem xét

```{r}

Income_NA_Customer <- dataframe_cleaning %>%
  select(ID,Income,Total_Spending,Average_Order_Value,Total_Purchase) %>%
  filter(is.na(Income))
summary(Income_NA_Customer)

``` 

=> Cho thấy rằng những người có dữ liệu Income NA là khách hàng chi tiêu mua sắm cũng khá là cao nên sẽ không bỏ dữ liệu này nếu bỏ sẽ làm sai lệch phân tích khách hàng giá trị cao. Nhưng để tiện cho việc Analyze chúng ta phải cần biến dữ liệu NA này thành dữ liệu số, nên tôi quyết định sẽ điền giá trị thiếu bằng mức thu nhập trung vị.

*(Tại sao là Trung vị ? vì thu nhập thường có bị lệch (có người quá nghèo, có người quá giàu), nên số trung vị (người đứng giữa) đại diện tốt hơn cho số trung bình).*

*(Tại sao lại `high_Income` ? Vì biến đó để tránh việc gom nhóm những khách có chi tiêu cao nhưng lại có mức lương trung vị (nếu mức lương đó thấp) thì sẽ lỡ mất khách hàng vip khi mình sẽ phân nhóm họ vô mức lương trung bình hoặc ngược lại lỡ có người lương trung bình nhưng lại chi tiêu khá cao dẫn đến "Anomaly").*
 
```{r}
# Tính mốc lương để chuẩn bị điền.

Median_Income = median(dataframe_cleaning$Income,na.rm = TRUE)
high_Income = quantile(dataframe_cleaning$Income, 0.75, na.rm = TRUE) # Mức lương top 25%

# Điền các mức lương.

dataframe_processed <- dataframe_cleaning %>%
  mutate(Income = case_when(
    Income != is.na(Income) ~ Income,
    Income = is.na(Income) & Total_Spending > 1000 ~ high_Income, # Nếu họ chi tiêu nhiều 
    Income = is.na(Income) & Total_Spending <= 1000 ~ Median_Income # Nếu họ chi tiêu ít
  ))

summary(dataframe_processed$Income)

```

```{r}

# Xem xét có thể loại bỏ dữ liệu Income 666666 vì nếu chỉ số này tồn tại sẽ khiến phân phối của biến Income bị lệch phải mạnh
dataframe_processed %>%
   select(ID, Income, Total_Spending, Total_Purchase) %>%
   filter(Income > 600000)

# Cho thấy khách hàng này có thể loại bỏ được
dataframe_processed <- dataframe_processed %>%
  filter(Income < 600000)

ggplot(dataframe_processed, aes(x = Income)) + geom_density() + scale_x_continuous(labels = label_comma()) + labs(title = "Bảng phân phối thu nhập của khách hàng", x = "Thu nhập")
```

### Biến `Education`

```{r}
# Kiểm tra các quan sát trong biến
table(dataframe_processed$Education)

# chuyển đổi dữ liệu trùng (2n Cycle).

dataframe_processed <- dataframe_processed %>%
  mutate(Education = case_when(Education == "2n Cycle" ~ "Master",
                               TRUE ~ Education))

table(dataframe_processed$Education)

```


### Biến `Total_Spending`

```{r}
# Kiểm tra logic
summary(dataframe_processed$Total_Spending)
# Distribution 

ggplot(dataframe_processed, aes(x = Total_Spending)) + geom_density() + labs(title = "Biểu đồ phân phối chi tiêu ", x = "Tổng chi tiêu")
```

Nhận xét biểu đồ: 

- Phân phối bị **lệch phải rõ rệt**, trong đó nguyên nhân phần lớn khách hàng có mức **chi tiêu thấp**, và chỉ một tỷ lệ nhỏ khách hàng có tổng chi tiêu cao.

- Đối chiếu với phần summary phía trên, giá trị mean cao hơn đáng kể so với median xác nhận **sự tồn tại**  của các khách hàng chi tiêu rất cao kéo phân phối bị lệch phải.

### Biến `AOV`

```{r}
# Kiểm tra Logic
summary(dataframe_processed$Average_Order_Value)

# Phân phối của biến
ggplot(dataframe_processed, aes(x = Average_Order_Value)) + geom_density() + labs(title = "Biểu đồ phân phối trung bình giá trị đơn hàng", x = "Trung bình giá trị đơn hàng")
```

Nhận xét biểu đồ:

- Phân phối của biến **lệch phải khá mạnh** với một số giá trị khá lớn. (Do có outlier )

- Và các outlier được giữ lại bởi vì nhiều khả năng quan sát này sẽ đại diện cho nhóm khách hàng có giá trị cao (High-value Customers).

Các đơn biến đã được xem xét và xử lý, mục đích làm cho bước phân tích không xuất hiện những giá trị gây sai lệch lớn. 

# **5. Analyze ** 

Đến bước này ta sẽ tiến hành phân tích đa biến (Bằng cách tạo bảng, biểu đồ được hiển thị bằng nhiều yếu tố khác nhau) để từ đó chúng ta rút ra được là phân khúc khách hàng, những nhóm khách hàng nào phản hồi tốt cho chiến dịch marketing sắp tới và những sản phẩm, những kênh bán hàng hiệu quả mà chúng ta cần quan tâm.

## 1. Phân khúc khách hàng


### Nhóm khách hàng có tổng số lần mua hàng.

Do tồn tại 1 giá trị cao (outlier) không trực quan rõ nên tôi sẽ tiến hành lọc dữ liệu đó ra, không phải là bỏ quan sát đó chỉ là có cái nhìn trực quan hơn với những dữ liệu còn lại.

Biến tổng số lần mua hàng của khách hàng được tính dựa trên các kênh bán hàng (web, store, catalog), để rõ hơn tôi tiến hành phân nhóm khách hàng như sau: 

- Mua dưới 10 lần => "Low".

- Mua trên 10 và dưới 20 => "Medium".

- Mua trên 20 => "High".

```{r}
# Tạo biến mới cho dataframe

dataframe_Analyze <- dataframe_processed %>%
  mutate(Purchase_Frequency = case_when(Total_Purchase < 10 ~ "Low",
                                        Total_Purchase >= 10 & Total_Purchase < 20 ~ "Medium",
                                        Total_Purchase >= 20 ~ "High"),
         Purchase_Frequency = factor(Purchase_Frequency,
                                     levels = c("Low", "Medium","High")))
# Tạo bảng
Table_1 <- dataframe_Analyze  %>% 
  group_by(Purchase_Frequency) %>%
  summarise(Count = n(),
            Mean_AOV = mean(Average_Order_Value),
            Median_AOV = median(Average_Order_Value),
            SD_AOV = sd(Average_Order_Value)) 

kable(Table_1, caption = "Doanh thu trung bình của nhóm khách hàng theo tần suất mua hàng ")
```
Nhận xét số liệu: 

- Nhóm Medium có giá trị đơn hàng trung bình (Mean_AOV) tăng gấp 3.5 lần so với nhóm Low (15.19712 vs 54.31663).

- Tuy nhiên, không có sự thay đổi về giá trị đơn hàng giữa 2 nhóm Medium và High.

- Nhóm low thì hành vi chi tiêu của nhóm này khó đoán bởi vì chỉ số `SD_AOV` khá là cao.

Để hiểu rõ hơn về phân phối dữ liệu và ổn định, tôi sẽ tiến hành trực quan hoá bằng biểu đồ hộp 

```{r}
dataframe_Analyze %>%
  filter(Average_Order_Value < 1500) %>%
  ggplot(aes(x = Purchase_Frequency, y = Average_Order_Value, fill = Purchase_Frequency)) +
  geom_boxplot() + 
  theme_minimal() +
  labs(title = "Giá trị đơn hàng theo tần suất mua",
       x = "Nhóm tần suất mua",
       y = "Giá trị trung bình đơn hàng")
  
```
Chú thích biểu đồ:

Đường đậm: ở các hộp là biểu thị cho mức chi tiêu trung bình đơn hàng (median).

Chiều cao của hộp: phần lớn khách hàng trong nhóm đó chi tiêu nằm trong khoảng.

Các điểm phía trên: một số khách hàng chi tiêu vượt quá mức giá trị (outliers).

Insights:

- Biểu đồ xác nhận rằng nhóm Low có rất nhiều ngoại lai (Outliers), cho thấy hành vi mua sắm của nhóm này chưa ổn định.

- Về kích thước hộp của 2 biến Medium và High không cách biệt khá lớn cho thấy phạm vi giá trị của 2 nhóm này dường như không có khác biệt, nói lên rằng nhóm khách hàng có tần suất mua hàng cao có chỉ số AOV cao là do họ thường xuyên mua hàng. 

- Nhóm High có độ biến thiên (độ dài hộp) nhỏ nhất, chứng tỏ đây là nhóm khách hàng ổn định nhất.

Điều này có thể cho thấy, ta có thể dự đoán được những người mua thường xuyên sẽ có giá trị hơn về mặt doanh thu.

### Nhóm khách hàng sử dụng khuyến mãi .

Về biến Deal_Dependency được tính bằng công thức tỷ lệ giữa tổng số lần sử dụng khuyến mãi với tổng số lần mua. Tức là nếu chỉ số Deal_Dependency càng lớn thì chứng tỏ khách hàng sử dụng khuyến mãi nhiều, và ngược lại Deal_Dependency tiến gần về 0 thì số lần sử dụng khuyến mãi khá ít. Để phân tích nhóm khách hàng này, tôi sẽ tiến hành phân khúc khách hàng như sau:

- Deal_Dependency = 0 => Không sử dụng deal.

- Deal_Dependency thuộc khoảng (0, 0.2] => Mức sử dụng deal vừa phải.

- Deal_Dependency thuộc khoảng (0.2 , 0.5] => Phụ thuộc vào việc sử dụng deal.

- Deal_Dependency lớn hơn 0.5 => Nghiện sử dụng deal. 

Mức phân bổ này tôi dựa theo vào việc thống kê mô tả biến Deal_Dependency dựa trên tứ phân vị, có thể nói là dựa trên phân phối của biến.

```{r}
# Tạo biến phân khúc khách hàng cho dataframe

dataframe_Analyze <- dataframe_processed %>%
  mutate(Deal_Group = case_when(Deal_Dependency == 0 ~ "Không sử dụng",
                                Deal_Dependency > 0 & Deal_Dependency <= 0.2 ~ "Vừa phải",
                                Deal_Dependency > 0.2 & Deal_Dependency <= 0.5 ~ "Phụ thuộc",
                                Deal_Dependency > 0.5 ~ "Nghiện deal"),
        Deal_Group = factor(Deal_Group, levels = c("Không sử dụng",
                                                   "Vừa phải",
                                                   "Phụ thuộc",
                                                   "Nghiện deal")))

# Table 
Table_2 <- dataframe_Analyze %>%
  group_by(Deal_Group) %>%
  summarise(Count = n(),
            Average_Total_Spending = mean(Total_Spending),
            Median_Total_Spending = median(Total_Spending),
            Max_Total_Spending = max(Total_Spending))
kable(Table_2,caption = "Tổng chi tiêu của nhóm khách hàng sử dụng khuyến mãi")
```
Insight: 

- Những khách hàng không sử dụng khuyến mãi là những khách hàng có chi tiêu rất cao tuy lượng khách hàng rất ít so với những nhóm khách hàng khác nhưng lại rất chất lượng. Mang lại nguồn doanh thu lớn (Những khách hàng giá trị).

- Còn những khách hàng phụ thuộc vào deal (High - Very High) cho thấy họ quan tâm vào khuyến mãi nhưng đa phần là những đơn hàng giá trị thấp. (Nhạy cảm với giá).

- Tuy nhiên xuất hiện vài khách hàng "Value-driven" trong các nhóm khách hàng phụ thuộc nhiều vào khuyến mãi (High - Very High). Họ có khả năng tài chính tốt nhưng đa phần họ sẽ chờ đợi các đợt khuyến mãi để mua hàng, những đơn hàng họ chi trả cũng khá cao (dựa theo mục Max_Total_Spending).


```{r}

  ggplot(dataframe_Analyze,aes(x = Deal_Group, y = Total_Spending, fill = Deal_Group)) + 
  geom_boxplot() + 
  theme_minimal() +
  labs(title = "Biểu đồ hộp tổng chi tiêu của các phân khúc khách hàng", x = "Nhóm", y = "Tổng chi tiêu")

```

Chú thích biểu đồ:

- **Đường đậm** ở các hộp là biểu thị cho mức chi tiêu trung bình (median) của các nhóm khách hàng.

- **Chiều cao của hộp**: phần lớn khách hàng trong nhóm đó chi tiêu nằm trong khoảng.

- **Các điểm phía trên**: một số khách hàng chi tiêu rất cao (outliers).

Insights: 

- Biểu đồ cho ta thấy mối tương quan nghịch mạnh mẽ giữa mức độ phụ thuộc khuyến mãi (Deal_Depency) và Tổng chi tiêu mua hàng (Total_Spending). Cụ thể, khi khách hàng phụ thuộc vào khuyến mãi thì tổng số tiền họ chi trung bình cho các sản phẩm giảm đi đáng kể.

- Có 2 nhóm khách hàng (Không sử dụng deal, sử dụng mức vừa phải) có phần trung bình khá cao.

- Cột Phụ thuộc, nghiện deal có trung bình chi tiêu thấp nhất, xuất hiện có nhiều khách hàng(Outlier) mua hàng giá trị cao nhưng vẫn phụ thuộc vào khuyến mãi. (Cần xem xét về outliers này vì có thể là những khách hàng "thông thái" tức là họ có thể chi trả cho những sản phẩm giá trị cao nhưng chỉ đợi các đợt khuyến mãi lớn để mua hàng).

### Nhóm khách hàng theo học vị và mức thu nhập

Biến Education trong dữ liệu thô có đến 5 quan sát (Basic, Gra, 2n cycle, Master, PhD). Do biến 2n Cycle và Master trùng về mặt ý nghĩa nên tôi đã tiến hành gộp lại thành 1 quan sát chung là "Master".

Đầu tiên ta sẽ nhìn về bảng số liệu của nhóm khách hàng theo học vị.

```{r}

Table_3 <- dataframe_Analyze %>%
  group_by(Education) %>%
  summarise(Average_Total_Spending = mean(Total_Spending),
            Median_Total_Spending = median(Total_Spending),
            Max_Total_Spending = max(Total_Spending),
            SD_Total_Spending = sd(Total_Spending))

kable(Table_3, caption = "Tổng mức chi tiêu của nhóm khách hàng theo học vị")
```

Nhận xét số liệu:

- Những khách hàng bình thường có mức chi tiêu thấp nhất (81.7973) cách khá xa với các nhóm còn lại.

- Những khách hàng ở 3 bậc học vị còn lại có trung bình chi tiêu cao nhưng với độ lệch chuẩn khá cao phản ánh chi tiêu chênh lệch rất lớn (Có người chi tiêu nhiều, có người chi tiêu rất ít).

Vì vậy học vấn chưa phải là yếu tố duy nhất quyết định chi tiêu. Để có thể trực quan hơn, tôi tiến hành vẽ biểu đồ scatter plot (với trục tung là tổng doanh thu, còn trục hoành là mức thu nhập, và các quan sát được tô màu theo các học vị).

```{r}
ggplot(dataframe_processed, aes(x = Income, y = Total_Spending)) +
  geom_point(aes(color = Education)) +
  # Thêm đường xu hướng (Trend line)
  geom_smooth(method = "lm", color = "red") +
  labs(
    title = "Biểu đồ phân tán giữa Thu nhập và Tổng chi tiêu",
    subtitle = "Điểm dữ liệu: Học vị",
    x = "Thu nhập của khách hàng",
    y = "Tổng chi tiêu"
  ) +
  theme_minimal()

```
Insights:

- Những chấm màu hồng nhạt nhỏ đại diện cho nhóm Basic cho thấy mức chi tiêu họ khá thấp.

- Khác với 3 nhóm còn lại, độ phân tán chồng chéo lên nhau cho thấy những học vấn cao (Graduation, Master, PhD) có xu hướng thu nhập và chi tiêu tương đồng nhau, cho thấy mối tương quan thuận mạnh mẽ giữa Thu nhập và Tổng chi tiêu bất kể bằng cấp.

- Tuy nhiên vẫn tồn tại một số ngoại lệ (outliers) có thu nhập rất cao > 150000 nhưng mức chi tiêu không đáng kể.

## 2. Tỷ lệ phản hồi các chương trình tiếp thị của khách hàng.

Do vấn đề trước đó cũng chúng ta là triển khai chiến lược cho đồng loạt cả toàn bộ tập khách hàng dẫn đến tỷ lệ phản hồi(acceptance rate) thấp .Qua quá trình phân tích về từng nhóm khách hàng theo các hành vi, nhân khẩu học thì trong đó nhóm khách hàng gây ảnh hưởng, có mối quan hệ tuyến tính mạnh và đồng đều đối với doanh thu của công ty là Incom (mức lương cao thì chi tiêu cao), cho nên chúng ta sẽ tập trung phân bổ khách hàng theo Income. 

Tôi sẽ tạo ra một bảng Phân tích chéo (Cross - Tabulation) kết hợp 2 yếu tố quan trọng nhất: Mức thu nhập và hành vi mua sắm (Deal). Được phân bổ như sau:

Khách hàng sẽ được chia theo 3 nhóm (Mức lương cao/ trung bình/ thấp kém - Săn deal/ khách mua hàng bình thường).

```{r}
# Xem các mốc phân vị (Quantile)

quantile(dataframe_processed$Deal_Dependency, probs = c(0.25, 0.5, 0.75, 0.9))

# => Chọn 0.2 làm điểm giữa để chia 2 giá trị phân loại "Deal Hunter" và "Organic Buyer")
```

```{r}

# Tạo các biến phân loại khách hàng.
dataframe_Marketing <- dataframe_Analyze %>%
  mutate(Income_level = case_when(Income < 40000 ~ "Low Income",
                                  Income >= 40000 & Income < 80000 ~ "Mid Income", 
                                  TRUE ~ "High Income"), #Biến phân loại mức lương
         Behavior_Type = case_when(Deal_Dependency > 0.2 ~ "Deal Hunter", # Săn deal
                                   TRUE ~ "Organic Buyer")) #Khách hàng mua bình thường
# Tạo bảng tổng hợp phục vụ Marketing.
Marketing_Table <- dataframe_Marketing %>%
  group_by(Income_level, Behavior_Type) %>%
  summarise(Count = n(),
            Average_Total_Spending = mean(Total_Spending),
            Response_Rate_Campaign = mean(Response) * 100, # Chấp nhận chiến dịch cuối
            Total_Accept_Cmpt      = sum(AcceptedCmp1 +
                                     AcceptedCmp2 +
                                     AcceptedCmp3 + 
                                     AcceptedCmp4 + 
                                     AcceptedCmp5 )) %>%
  arrange(desc(Average_Total_Spending))


kable(Marketing_Table, caption = "Chiến lược Marketing: Thu nhập vs Hành vi")

```
Insight: 

**Nhóm khách hàng VIP (giá trị cao cho doanh thu)**:

- (High income - Deal Hunter) nhóm này mua hàng trong các đợt khuyến mãi nhưng lại đặt những món hàng giá trị rất cao. Tuy nhiên việc phản hồi về chiến dịch tiếp theo của công ty có vẻ không khả quan lắm.

- (High income - Organic Buyer) đây là nhóm khách hàng giá trị nhất. Dù số lượng không quá đông (209 người), nhưng họ có mức chi tiêu khủng (1512.818) và đặc biệt là tỷ lệ phản hồi cho chiến dịch lần này có vẻ họ rất là quan tâm **tới (41.6%)** cao nhất với các nhóm còn lại.

**Nhóm tiềm năng (Nòng cốt)**:

- Nhóm khách hàng tiềm năng (Mid Income - Organic Buyer) Nhóm này chiếm số lượng chi tiêu nhiều nhất trong các nhóm, và cũng vừa chiếm mức trung bình chi tiêu khá cao, đây là nhóm mang lại **dòng tiền ổn định nhất** với số lượng đông áp đảo (802 người) và mức chi tiêu khá (941), họ đóng góp phần lớn vào tổng doanh thu toàn công ty.

**Nhóm săn khuyến mãi**:

- Tập trung chủ yếu ở (Mid Income - Deal hunter, Low Income) Tuy số lượng khách hàng cũng ở mức kha khá tuy nhiên về phần trung bình chi tiêu của họ lại thấp hơn các nhóm (Chỉ bằng 1/2 đến 1/10 của nhóm Organic Buyer).

## 3. Các kênh bán hàng.

Dưới đây tôi sẽ tiến hành phân tích về 3 kênh bán hàng Web/ Catalog/ Store dựa trên các chỉ số hiệu suất (KPIs) khác nhau để thấy bức tranh toàn diện. 

**Lưu ý**: Trong bộ dữ liệu này, **không có doanh thu riêng cho từng kênh** chỉ có tổng chi tiêu của các mặt hàng, nên tôi chỉ có thể so sánh *Số lượng đơn hàng (Number of Purchases)* và *tỷ lệ chuyển đổi (Web)*.

Đầu tiên tôi sẽ thống kê mô tả để hiểu logic của dữ liệu:

```{r}
# 1. Tạo bảng tổng hợp số lượng đơn hàng theo kênh

channel_summary <- dataframe_Marketing %>%
  summarise(
    Store = sum(NumStorePurchases),
    Web = sum(NumWebPurchases),
    Catalog = sum(NumCatalogPurchases)
  ) %>%
  # Chuyển từ dạng ngang (Wide) sang dạng dọc (Long) để vẽ Pie Chart
  pivot_longer(cols = everything(), names_to = "Channel", values_to = "Orders") %>%
  mutate(Percentage = round(Orders / sum(Orders) * 100, 1))

kable(channel_summary, caption = "Các kênh bán hàng")

# 2. Vẽ Pie Chart
ggplot(channel_summary, aes(x = "", y = Orders, fill = Channel)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(Percentage, "%")), position = position_stack(vjust = 0.5)) +
  labs(title = "Tỷ trọng Đơn hàng giữa các Kênh", fill = "Kênh bán") +
  theme_void() 

```

Insight: 

- Về kênh bán hàng mang lại số lượng cao nhất cho công ty là Store, chiếm 46.2%  cho thấy Store vẫn là kênh bán hàng chủ lực của công ty.

- Kế tiếp là Website, chiếm 32.6% để có thể xem được hiệu quả của kênh này chúng ta sẽ tính tỷ lệ chuyển đổi của website.

- Cuối cùng là Catalog, chiếm 21.2% mang lại lượng đơn nhỏ nhất (cần xem xét kỹ hơn)

### Tỷ lệ chuyển đổi của Website

```{r}
# Tính hiệu quả chuyển đổi của Website

Web_Efficency <- dataframe_Marketing %>%
  summarise(Total_Visits = sum(NumWebVisitsMonth),
            Total_Purchase_Web = sum(NumWebPurchases),
            Conversion_Rate = sum(NumWebPurchases) / sum(NumWebVisitsMonth)) 
Web_Efficency

  
```
Insight:

- Chỉ số chuyển đổi gần với 1 cho thấy kênh bán hàng Website đang hoạt động rất hiệu quả, cần kéo thêm traffic để tăng thêm doanh thu.

## 4. Phân phối sản phẩm

Để linh hoạt hơn thì tôi tiến hành dùng yếu tố Con cái (childrens) là biến số  có tác động mạnh đến hành vi mua sắm trong bộ dữ liệu này. Tôi đã tạo trước đó trong phần Process (Family_Status)
```{r}
# 1. Chuẩn bị dữ liệu: Gom nhóm theo số lượng con cái

Product_Table <- dataframe_Analyze %>%
  group_by(Family_Status) %>%
  summarise(Avg_Wine = mean(MntWines),
            Avg_Meat = mean(MntMeatProducts),
            Avg_Fish = mean(MntFishProducts),
            Avg_Sweet = mean(MntSweetProducts),
            Avg_Gold = mean(MntGoldProds)) %>%
  # Chuyển dạng rộng (wide) sang dạng dài (Long) để vẽ biểu đồ
  pivot_longer(cols = starts_with("Avg"), names_to = "Product", values_to = "Spending")

# 2. Vẽ biểu đồ so sánh
ggplot(Product_Table, aes(x = Product, y = Spending, fill = Family_Status)) +
  geom_col(position = "dodge") +
  coord_flip() + # Xoay ngang cho dễ đọc tên sản phẩm
  labs(title = "Biểu đồ hiển thị doanh thu trung bình từng sản phẩm",
       subtitle = "Dựa trên biến phân loại: Childless và Parents",
       x = "Trung bình doanh thu",
       y = "Sản phẩm")

```

Insight:

- Biểu đồ hiển thị khá rõ ràng về sự ảnh hưởng của Biến số (Con cái) cho thấy rằng những người có con mức chi tiêu trung bình trên tất cả các mặt hàng thấp hơn rất nhiều so với những người không có con.

- Những người không có con thường chi tiêu mạnh vào mặt hàng (Rượu và thịt). Doanh thu trung bình 2 sản phẩm đó cách khá xa với những sản phẩm còn lại, có thể xem đây là 2 mặt hàng chủ lực.

# **6. Recommendation**

## Tóm tắt cụ thể

Dữ liệu cho thấy Thu nhập và Cấu trúc gia đình (con cái) là hai yếu tố than chốt ảnh hưởng đến hành vi mua sắm các sản phẩm. Chiến lược tiếp thị sắp tới nên tập trung vào nhóm High Income - Organic để tối ưu hoá chiến dịch Marketing hiệu quả. Đồng thời tập trung đẩy mạnh các kênh bán hàng Store/website tạo ra các chương trình tiếp thị, quảng cáo. Đồng thời cá nhân hoá danh mục sản phẩm Thịt và Rượu để có thể tối ưu cho 2 đối tượng (Có con và không con).

## Hành động
